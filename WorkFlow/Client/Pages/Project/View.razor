@page "/{CompanyURI}/project/{ProjectURI}"        
@inject ITicket _ticketService
@inject IProject _projectService
<div>
    <div class="flex flex-row-reverse mb-5">
        <a href="@CompanyURI/project/@ProjectURI/ticket/create">
            <button class="p-2 pl-5 pr-5 bg-blue-500 border-blue-300 text-gray-100 text-md rounded-lg focus:border-4 mr-14">Create Ticket</button>
        </a>
        <a href="@CompanyURI/project/@ProjectURI/manage">
            <button class="p-2 pl-5 pr-5 bg-yellow-600 border-yellow-300 text-gray-100 text-md rounded-lg focus:border-4 mr-5">Manage Project</button>
        </a>
    </div>

    <div class="flex flex-wrap justify-around justify-items-stretch h-4/5 mb-5" style="min-height: 80vh;">
        <div class="bg-gray-400 border-2 border-black" style="width: 405px;">
            <h2 class="text-center text-2xl border-b-2 border-black">TO-DOs</h2>
            <div>
                @foreach (var ticket in TodoTickets)
                {
                    <a href="@CompanyURI/project/@ProjectURI/ticket/@ticket.Id/manage">
                        <UserTicket ticket="@ticket" HideColour="true" />
                    </a>
                }
            </div>
        </div>
        <div class="bg-yellow-100 border-2 border-black" style="width: 405px;">
            <h2 class="text-center text-2xl border-b-2 border-black">In-Progress</h2>
            <div>
                @foreach (var ticket in InProgressTickets)
                {
                    <a href="@CompanyURI/project/@ProjectURI/ticket/@ticket.Id/manage">
                        <UserTicket ticket="@ticket" HideColour="true" />
                    </a>
                }
            </div>
        </div>
        <div class="bg-green-200 border-2 border-black" style="width: 405px;">
            <h2 class="text-center text-2xl border-b-2 border-black">Completed</h2>
            <div>
                @foreach (var ticket in CompletedTickets)
                {
                    <a href="@CompanyURI/project/@ProjectURI/ticket/@ticket.Id/manage">
                        <UserTicket ticket="@ticket" HideColour="true" />
                    </a>
                }
            </div>
        </div>
    </div>
</div>

@code {

    [Parameter]
    public String CompanyURI { get; set; }

    [Parameter]
    public String ProjectURI { get; set; }

    private List<TicketDto> TodoTickets { get; } = new();
    private List<TicketDto> InProgressTickets { get; } = new();
    private List<TicketDto> CompletedTickets { get; } = new();


    protected override async Task OnParametersSetAsync()
    {
        TodoTickets.Clear();
        InProgressTickets.Clear();
        CompletedTickets.Clear();
        
        var project = await _projectService.Get(ProjectURI);
        var tickets = await _ticketService.ListTicketsByProject(project.Id);
        foreach (var ticket in tickets)
        {
            switch (ticket.Status)
            {
                case Status.ToDo:
                    TodoTickets.Add(ticket);
                    break;
                case Status.InProgress:
                    InProgressTickets.Add(ticket);
                    break;
                case Status.Completed:
                    CompletedTickets.Add(ticket);
                    break;
            }
        }
    }

}